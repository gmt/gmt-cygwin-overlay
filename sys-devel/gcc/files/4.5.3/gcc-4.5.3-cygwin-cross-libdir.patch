This is a back-port of David Korn's patches which can be found at

  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=40125

The patches are designed to fix a problem with the placement of shared
libraries during cross-builds.  As a side effect, they fix the failure
of the generated Makefiles for native cygwin builds to copy
cyggcc_s-1.dll back into the "gcc" directory, which occurs at the end
of each each stage compliation (in this version, they now end up in
"prev-gcc" directories, with an $EPREFIX'ed subpath, due, I'm presuming
to the use of $DESTDIR in the Makefiles -- which seems pretty
wierd to me, but what do I know?  Not much, about this, at least, so
I'm leaving that intact until something gives me a reason not to).

Without this, the build still succeeds, and appears to generate a
perfectly fine compiler -- in fact, the official cygport doesn't
provide any solution to this, which leads me to suspect that when
all is said and done, the results are pretty much the same.

Even so, I just felt more comfortable not seeing "failure to create
regular file ... cyggcc_s-1.dll" scrolling by.  I'm not sure if the
intermediate libraries are actually used by the various stage scripts,
so this may well amount to a superstitious fix to a purely cosmetic
issue.  At least it doesn't seem to break anything, and may
fix real problems when cross-compiling, so my best guess is that
including it does more good than harm.

If someone smarter than me can confirm that this does something useful,
Gentoo might want to just include this in the 4.5.x tarball patches
unconditionally, since it also purports to fix the same problem during
cross-builds for additional platforms, notably including mingw32.

-gmt

diff -urN gcc-4.5.3.orig/config/ChangeLog gcc-4.5.3/config/ChangeLog
--- gcc-4.5.3.orig/config/ChangeLog	2011-04-28 07:11:26.000000000 -0700
+++ gcc-4.5.3/config/ChangeLog	2012-09-13 01:47:45.932501500 -0700
@@ -6,6 +6,13 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* lthostflags.m4: New file.
+	(ACX_LT_HOST_FLAGS): Define.
+
 2010-10-02  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>
 
 	* po.m4 (AM_PO_SUBDIRS): Fix unportable shell quoting.
diff -urN gcc-4.5.3.orig/config/lthostflags.m4 gcc-4.5.3/config/lthostflags.m4
--- gcc-4.5.3.orig/config/lthostflags.m4	1969-12-31 16:00:00.000000000 -0800
+++ gcc-4.5.3/config/lthostflags.m4	2012-09-13 01:47:45.954501500 -0700
@@ -0,0 +1,33 @@
+dnl Copyright (C) 2010 Free Software Foundation, Inc.
+dnl This file is free software, distributed under the terms of the GNU
+dnl General Public License.  As a special exception to the GNU General
+dnl Public License, this file may be distributed as part of a program
+dnl that contains a configuration script generated by Autoconf, under
+dnl the same distribution terms as the rest of that program.
+
+dnl usage: ACX_LT_HOST_FLAGS([default_flags])
+dnl Defines and AC_SUBSTs lt_host_flags
+
+
+AC_DEFUN([ACX_LT_HOST_FLAGS], [
+AC_REQUIRE([AC_CANONICAL_SYSTEM])
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=[$1]
+    ;;
+esac
+
+AC_SUBST(lt_host_flags)
+])
diff -urN gcc-4.5.3.orig/gcc/ChangeLog gcc-4.5.3/gcc/ChangeLog
--- gcc-4.5.3.orig/gcc/ChangeLog	2011-04-28 07:11:53.000000000 -0700
+++ gcc-4.5.3/gcc/ChangeLog	2012-09-13 01:47:45.964501500 -0700
@@ -969,6 +969,20 @@
 	* config/pa/stublib.c (pthread_default_stacksize_np, pthread_mutex_lock,
 	pthread_mutex_unlock): New stubs.
 
+2011-01-26  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	* config.gcc (i[34567]86-*-pe | i[34567]86-*-cygwin*): Select suitable
+	t-dlldir{,-x} fragment for build and add it to tmake_file.
+	(i[34567]86-*-mingw* | x86_64-*-mingw*): Likewise.
+	* Makefile.in (libgcc.mvars): Also export SHLIB_DLLDIR to libgcc.
+	* config/i386/t-dlldir: New file.
+	(SHLIB_DLLDIR): Define.
+	* config/i386/t-dlldir-x: New file.
+	(SHLIB_DLLDIR): Define.
+	* config/i386/t-cygming: Error out if SHLIB_DLLDIR is not set.
+	(SHLIB_INSTALL): Use it.
+
 2011-01-26  Eric Botcazou  <ebotcazou@adacore.com>
 
 	PR rtl-optimization/44469
diff -urN gcc-4.5.3.orig/gcc/Makefile.in gcc-4.5.3/gcc/Makefile.in
--- gcc-4.5.3.orig/gcc/Makefile.in	2012-09-13 00:20:20.306001500 -0700
+++ gcc-4.5.3/gcc/Makefile.in	2012-09-13 01:47:45.974501500 -0700
@@ -1875,6 +1875,7 @@
 	echo GCC_EXTRA_PARTS = '$(GCC_EXTRA_PARTS)' >> tmp-libgcc.mvars
 	echo SHLIB_LINK = '$(subst $(GCC_FOR_TARGET),$$(GCC_FOR_TARGET),$(SHLIB_LINK))' >> tmp-libgcc.mvars
 	echo SHLIB_INSTALL = '$(SHLIB_INSTALL)' >> tmp-libgcc.mvars
+	echo SHLIB_DLLDIR = '$(SHLIB_DLLDIR)' >> tmp-libgcc.mvars
 	echo SHLIB_EXT = '$(SHLIB_EXT)' >> tmp-libgcc.mvars
 	echo SHLIB_MKMAP = '$(call srcdirify,$(SHLIB_MKMAP))' >> tmp-libgcc.mvars
 	echo SHLIB_MKMAP_OPTS = '$(SHLIB_MKMAP_OPTS)' >> tmp-libgcc.mvars
diff -urN gcc-4.5.3.orig/gcc/config/i386/t-cygming gcc-4.5.3/gcc/config/i386/t-cygming
--- gcc-4.5.3.orig/gcc/config/i386/t-cygming	2010-06-14 03:38:18.000000000 -0700
+++ gcc-4.5.3/gcc/config/i386/t-cygming	2012-09-13 01:47:45.978501500 -0700
@@ -72,6 +72,11 @@
 SHLIB_OBJS = @shlib_objs@
 SHLIB_DIR = @multilib_dir@/shlib
 SHLIB_SLIBDIR_QUAL = @shlib_slibdir_qual@
+# SHLIB_DLLDIR is defined by including one of either t-dlldir or t-dlldir-x
+# (native/cross build respectively) in the tmake_file list in gcc/config.gcc.
+ifndef SHLIB_DLLDIR
+$(error SHLIB_DLLDIR must be defined)
+endif
 
 SHLIB_LINK = $(LN_S) -f $(SHLIB_MAP) $(SHLIB_MAP).def && \
 	if [ ! -d $(SHLIB_DIR) ]; then \
@@ -91,9 +96,10 @@
 # $(slibdir) double quoted to protect it from expansion while building
 # libgcc.mk.  We want this delayed until actual install time.
 SHLIB_INSTALL = \
-	$$(mkinstalldirs) $$(DESTDIR)$$(slibdir)$(SHLIB_SLIBDIR_QUAL); \
+	$$(mkinstalldirs) $$(DESTDIR)$$(SHLIB_DLLDIR) \
+	  $$(DESTDIR)$$(slibdir)$(SHLIB_SLIBDIR_QUAL); \
 	$(INSTALL_PROGRAM) $(SHLIB_DIR)/$(SHLIB_SONAME) \
-	  $$(DESTDIR)$$(bindir)/$(SHLIB_SONAME); \
+	  $$(DESTDIR)$$(SHLIB_DLLDIR)/$(SHLIB_SONAME); \
 	$(INSTALL_DATA) $(SHLIB_DIR)/$(SHLIB_IMPLIB) \
 	  $$(DESTDIR)$$(slibdir)$(SHLIB_SLIBDIR_QUAL)/$(SHLIB_IMPLIB)
 SHLIB_MKMAP = $(srcdir)/mkmap-flat.awk
diff -urN gcc-4.5.3.orig/gcc/config/i386/t-dlldir gcc-4.5.3/gcc/config/i386/t-dlldir
--- gcc-4.5.3.orig/gcc/config/i386/t-dlldir	1969-12-31 16:00:00.000000000 -0800
+++ gcc-4.5.3/gcc/config/i386/t-dlldir	2012-09-13 01:47:45.982501500 -0700
@@ -0,0 +1,6 @@
+
+# In a native build, target DLLs go in bindir, where they can be executed.
+# Note double quoting to prevent variables from being evaluated until install
+# time; we don't want to expand them during libgcc.mvars generation
+
+SHLIB_DLLDIR = $$(bindir)
diff -urN gcc-4.5.3.orig/gcc/config/i386/t-dlldir-x gcc-4.5.3/gcc/config/i386/t-dlldir-x
--- gcc-4.5.3.orig/gcc/config/i386/t-dlldir-x	1969-12-31 16:00:00.000000000 -0800
+++ gcc-4.5.3/gcc/config/i386/t-dlldir-x	2012-09-13 01:47:45.985501500 -0700
@@ -0,0 +1,9 @@
+
+# In a cross build, bindir contains host, not target binaries, so target DLLs
+# go in toolexeclibdir, alongside other target binaries and static libs.
+# Note double quoting to prevent variables from being evaluated until install
+# time; we don't want to expand them during libgcc.mvars generation, and in
+# any case, $toolexeclibdir is not defined in the gcc/ subdirectory, only in
+# target lib directories.
+
+SHLIB_DLLDIR = $$(toolexeclibdir)
diff -urN gcc-4.5.3.orig/gcc/config.gcc gcc-4.5.3/gcc/config.gcc
--- gcc-4.5.3.orig/gcc/config.gcc	2012-09-13 00:20:38.367001500 -0700
+++ gcc-4.5.3/gcc/config.gcc	2012-09-13 01:47:45.992501500 -0700
@@ -1342,7 +1342,13 @@
 	else
 		tmake_eh_file="i386/t-sjlj-eh"
 	fi
-	tmake_file="${tmake_file} ${tmake_eh_file} i386/t-cygming i386/t-cygwin"
+	# Shared libgcc DLL install dir depends on cross/native build.
+	if test x${host} = x${target} ; then
+		tmake_dlldir_file="i386/t-dlldir"
+	else
+		tmake_dlldir_file="i386/t-dlldir-x"
+	fi
+	tmake_file="${tmake_file} ${tmake_eh_file} ${tmake_dlldir_file} i386/t-cygming i386/t-cygwin"
 	target_gtfiles="\$(srcdir)/config/i386/winnt.c"
 	extra_options="${extra_options} i386/cygming.opt"
 	extra_objs="winnt.o winnt-stubs.o"
@@ -1398,7 +1404,13 @@
 	else
 		tmake_eh_file="i386/t-sjlj-eh"
 	fi
-	tmake_file="${tmake_file} ${tmake_eh_file} i386/t-cygming"
+	# Shared libgcc DLL install dir depends on cross/native build.
+	if test x${host} = x${target} ; then
+		tmake_dlldir_file="i386/t-dlldir"
+	else
+		tmake_dlldir_file="i386/t-dlldir-x"
+	fi
+	tmake_file="${tmake_file} ${tmake_eh_file} ${tmake_dlldir_file} i386/t-cygming"
         case ${target} in
                *-w64-*)
                		tmake_file="${tmake_file} i386/t-mingw-w64"
diff -urN gcc-4.5.3.orig/libffi/ChangeLog gcc-4.5.3/libffi/ChangeLog
--- gcc-4.5.3.orig/libffi/ChangeLog	2011-04-28 07:10:51.000000000 -0700
+++ gcc-4.5.3/libffi/ChangeLog	2012-09-13 01:47:46.010501500 -0700
@@ -9,6 +9,12 @@
 	uintptr_t first.
 	* testsuite/libffi.call/cls_pointer_stack.c (main): Likewise.
 
+2011-01-26  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	* configure.ac (AM_LTLDFLAGS): Add -bindir option for windows DLLs.
+	* configure: Regenerate.
+
 2010-12-17  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>
 
 	Backport from mainline:
diff -urN gcc-4.5.3.orig/libffi/configure gcc-4.5.3/libffi/configure
--- gcc-4.5.3.orig/libffi/configure	2012-09-13 00:20:40.595001500 -0700
+++ gcc-4.5.3/libffi/configure	2012-09-13 01:47:46.052501500 -0700
@@ -11359,8 +11359,15 @@
 	;;
   i?86-win32* | i?86-*-cygwin* | i?86-*-mingw*)
 	TARGET=X86_WIN32; TARGETDIR=x86
-	# All mingw/cygwin/win32 builds require this for sharedlib
-	AM_LTLDFLAGS='-no-undefined -bindir $(bindir)'
+	# All mingw/cygwin/win32 builds require -no-undefined for sharedlib
+	# We must also check with_cross_host to decide if this is a native
+	# or cross-build and select where to install dlls appropriately.
+	if test -n "$with_cross_host" &&
+	   test x"$with_cross_host" != x"$no"; then
+		AM_LTLDFLAGS='-no-undefined -bindir "$(toolexeclibdir)"';
+	else
+		AM_LTLDFLAGS='-no-undefined -bindir "$(bindir)"';
+	fi
 	;;
   i?86-*-darwin*)
 	TARGET=X86_DARWIN; TARGETDIR=x86
diff -urN gcc-4.5.3.orig/libffi/configure.ac gcc-4.5.3/libffi/configure.ac
--- gcc-4.5.3.orig/libffi/configure.ac	2012-09-13 00:20:38.373001500 -0700
+++ gcc-4.5.3/libffi/configure.ac	2012-09-13 01:47:46.119501500 -0700
@@ -82,8 +82,15 @@
 	;;
   i?86-win32* | i?86-*-cygwin* | i?86-*-mingw*)
 	TARGET=X86_WIN32; TARGETDIR=x86
-	# All mingw/cygwin/win32 builds require this for sharedlib
-	AM_LTLDFLAGS='-no-undefined -bindir $(bindir)'
+	# All mingw/cygwin/win32 builds require -no-undefined for sharedlib
+	# We must also check with_cross_host to decide if this is a native
+	# or cross-build and select where to install dlls appropriately.
+	if test -n "$with_cross_host" &&
+	   test x"$with_cross_host" != x"$no"; then
+		AM_LTLDFLAGS='-no-undefined -bindir "$(toolexeclibdir)"';
+	else
+		AM_LTLDFLAGS='-no-undefined -bindir "$(bindir)"';
+	fi
 	;;
   i?86-*-darwin*)
 	TARGET=X86_DARWIN; TARGETDIR=x86
diff -urN gcc-4.5.3.orig/libgcc/ChangeLog gcc-4.5.3/libgcc/ChangeLog
--- gcc-4.5.3.orig/libgcc/ChangeLog	2011-04-28 07:11:15.000000000 -0700
+++ gcc-4.5.3/libgcc/ChangeLog	2012-09-13 01:47:46.123501500 -0700
@@ -13,6 +13,16 @@
 	(powerpc*-eabi*): Likewise.
 	* config/rs6000/t-ppccomm (EXTRA_PARTS): Add crtbegin, crtend,
 	crtbeginS, crtendS, crtbeginT.
+2011-01-26  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	* configure.ac: Call ACX_NONCANONICAL_TARGET.
+	(toolexecdir): Calculate and AC_SUBST.
+	(toolexeclibdir): Likewise.
+	* Makefile.in (target_noncanonical): Import.
+	(toolexecdir): Likewise.
+	(toolexeclibdir): Likewise.
+	* configure: Regenerate.
 
 2010-12-16  Release Manager
 
diff -urN gcc-4.5.3.orig/libgcc/Makefile.in gcc-4.5.3/libgcc/Makefile.in
--- gcc-4.5.3.orig/libgcc/Makefile.in	2012-09-13 00:20:16.466001500 -0700
+++ gcc-4.5.3/libgcc/Makefile.in	2012-09-13 01:47:46.130501500 -0700
@@ -41,6 +41,7 @@
 fixed_point = @fixed_point@
 
 host_noncanonical = @host_noncanonical@
+target_noncanonical = @target_noncanonical@
 
 # List of extra object files that should be compiled for this target machine.
 # The rules for compiling them should be in the t-* file for the machine.
@@ -174,6 +175,9 @@
 libsubdir = $(libdir)/gcc/$(host_noncanonical)/$(version)
 # Used to install the shared libgcc.
 slibdir = @slibdir@
+# Maybe used for DLLs on Windows targets.
+toolexecdir = @toolexecdir@
+toolexeclibdir = @toolexeclibdir@
 
 export AR_FOR_TARGET
 export AR_CREATE_FOR_TARGET
@@ -193,6 +197,8 @@
 export RANLIB_FOR_TARGET
 export libsubdir
 export slibdir
+export toolexecdir
+export toolexeclibdir
 
 version := $(shell $(CC) -dumpversion)
 
diff -urN gcc-4.5.3.orig/libgcc/configure gcc-4.5.3/libgcc/configure
--- gcc-4.5.3.orig/libgcc/configure	2010-03-30 06:08:52.000000000 -0700
+++ gcc-4.5.3/libgcc/configure	2012-09-13 01:47:46.150501500 -0700
@@ -576,10 +576,13 @@
 NM
 LIPO
 AR
+toolexeclibdir
+toolexecdir
 target_subdir
 host_subdir
 build_subdir
 build_libsubdir
+target_noncanonical
 host_noncanonical
 host_os
 host_vendor
@@ -2174,6 +2177,8 @@
 esac
 
 
+
+
 # post-stage1 host modules use a different CC_FOR_BUILD so, in order to
 # have matching libraries, they should use host libraries: Makefile.tpl
 # arranges to pass --with-build-libsubdir=$(HOST_SUBDIR).
@@ -2204,6 +2209,36 @@
 target_subdir=${target_noncanonical}
 
 
+# Calculate toolexeclibdir
+# Also toolexecdir, though it's only used in toolexeclibdir
+case ${version_specific_libs} in
+  yes)
+    # Need the gcc compiler version to know where to install libraries
+    # and header files if --enable-version-specific-runtime-libs option
+    # is selected.
+    toolexecdir='$(libdir)/gcc/$(target_noncanonical)'
+    toolexeclibdir='$(toolexecdir)/$(gcc_version)$(MULTISUBDIR)'
+    ;;
+  no)
+    if test -n "$with_cross_host" &&
+       test x"$with_cross_host" != x"no"; then
+      # Install a library built with a cross compiler in tooldir, not libdir.
+      toolexecdir='$(exec_prefix)/$(target_noncanonical)'
+      toolexeclibdir='$(toolexecdir)/lib'
+    else
+      toolexecdir='$(libdir)/gcc-lib/$(target_noncanonical)'
+      toolexeclibdir='$(libdir)'
+    fi
+    multi_os_directory=`$CC -print-multi-os-directory`
+    case $multi_os_directory in
+      .) ;; # Avoid trailing /.
+      *) toolexeclibdir=$toolexeclibdir/$multi_os_directory ;;
+    esac
+    ;;
+esac
+
+
+
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ar", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ar; ac_word=$2
diff -urN gcc-4.5.3.orig/libgcc/configure.ac gcc-4.5.3/libgcc/configure.ac
--- gcc-4.5.3.orig/libgcc/configure.ac	2010-03-30 06:08:52.000000000 -0700
+++ gcc-4.5.3/libgcc/configure.ac	2012-09-13 01:47:46.165501500 -0700
@@ -103,8 +103,39 @@
 
 AC_CANONICAL_HOST
 ACX_NONCANONICAL_HOST
+ACX_NONCANONICAL_TARGET
 GCC_TOPLEV_SUBDIRS
 
+# Calculate toolexeclibdir
+# Also toolexecdir, though it's only used in toolexeclibdir
+case ${version_specific_libs} in
+  yes)
+    # Need the gcc compiler version to know where to install libraries
+    # and header files if --enable-version-specific-runtime-libs option
+    # is selected.
+    toolexecdir='$(libdir)/gcc/$(target_noncanonical)'
+    toolexeclibdir='$(toolexecdir)/$(gcc_version)$(MULTISUBDIR)'
+    ;;
+  no)
+    if test -n "$with_cross_host" &&
+       test x"$with_cross_host" != x"no"; then
+      # Install a library built with a cross compiler in tooldir, not libdir.
+      toolexecdir='$(exec_prefix)/$(target_noncanonical)'
+      toolexeclibdir='$(toolexecdir)/lib'
+    else
+      toolexecdir='$(libdir)/gcc-lib/$(target_noncanonical)'
+      toolexeclibdir='$(libdir)'
+    fi
+    multi_os_directory=`$CC -print-multi-os-directory`
+    case $multi_os_directory in
+      .) ;; # Avoid trailing /.
+      *) toolexeclibdir=$toolexeclibdir/$multi_os_directory ;;
+    esac
+    ;;
+esac
+AC_SUBST(toolexecdir)
+AC_SUBST(toolexeclibdir)
+
 dnl These must be called before AM_PROG_LIBTOOL, because it may want
 dnl to call AC_CHECK_PROG.
 AC_CHECK_TOOL(AR, ar)
diff -urN gcc-4.5.3.orig/libgfortran/ChangeLog gcc-4.5.3/libgfortran/ChangeLog
--- gcc-4.5.3.orig/libgfortran/ChangeLog	2011-04-28 07:09:02.000000000 -0700
+++ gcc-4.5.3/libgfortran/ChangeLog	2012-09-13 01:47:46.171501500 -0700
@@ -156,6 +156,16 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac: Invoke ACX_LT_HOST_FLAGS.
+	* Makefile.am (LTLDFLAGS): Use lt_host_flags.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+	* Makefile.in: Regenerate
+
 2010-11-10  Jerry DeLisle  <jvdelisle@gcc.gnu.org>
 
 	PR libgfortran/46373
diff -urN gcc-4.5.3.orig/libgfortran/Makefile.am gcc-4.5.3/libgfortran/Makefile.am
--- gcc-4.5.3.orig/libgfortran/Makefile.am	2009-11-30 12:43:06.000000000 -0800
+++ gcc-4.5.3/libgfortran/Makefile.am	2012-09-13 01:47:46.178501500 -0700
@@ -14,7 +14,7 @@
 endif
 
 LTLDFLAGS = $(shell $(SHELL) $(top_srcdir)/../libtool-ldflags $(LDFLAGS)) \
-	    -no-undefined -bindir "$(bindir)"
+	    $(lt_host_flags)
 
 toolexeclib_LTLIBRARIES = libgfortran.la
 libgfortran_la_LINK = $(LINK) $(libgfortran_la_LDFLAGS)
diff -urN gcc-4.5.3.orig/libgfortran/Makefile.in gcc-4.5.3/libgfortran/Makefile.in
--- gcc-4.5.3.orig/libgfortran/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libgfortran/Makefile.in	2012-09-13 01:47:46.188501500 -0700
@@ -48,6 +48,7 @@
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/../config/depstand.m4 \
 	$(top_srcdir)/../config/lead-dot.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/override.m4 \
 	$(top_srcdir)/../config/stdint.m4 \
@@ -943,6 +944,7 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
@@ -972,7 +974,7 @@
 @LIBGFOR_USE_SYMVER_FALSE@version_arg = 
 @LIBGFOR_USE_SYMVER_TRUE@version_arg = -Wl,--version-script=$(srcdir)/gfortran.map
 LTLDFLAGS = $(shell $(SHELL) $(top_srcdir)/../libtool-ldflags $(LDFLAGS)) \
-	    -no-undefined -bindir "$(bindir)"
+	    $(lt_host_flags)
 
 toolexeclib_LTLIBRARIES = libgfortran.la
 libgfortran_la_LINK = $(LINK) $(libgfortran_la_LDFLAGS)
diff -urN gcc-4.5.3.orig/libgfortran/aclocal.m4 gcc-4.5.3/libgfortran/aclocal.m4
--- gcc-4.5.3.orig/libgfortran/aclocal.m4	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libgfortran/aclocal.m4	2012-09-13 01:47:46.215501500 -0700
@@ -970,6 +970,7 @@
 
 m4_include([../config/depstand.m4])
 m4_include([../config/lead-dot.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/override.m4])
 m4_include([../config/stdint.m4])
diff -urN gcc-4.5.3.orig/libgfortran/configure gcc-4.5.3/libgfortran/configure
--- gcc-4.5.3.orig/libgfortran/configure	2011-04-28 07:31:38.000000000 -0700
+++ gcc-4.5.3/libgfortran/configure	2012-09-13 01:47:46.251501500 -0700
@@ -609,6 +609,7 @@
 FC
 enable_static
 enable_shared
+lt_host_flags
 CPP
 OTOOL64
 OTOOL
@@ -11306,7 +11307,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11309 "configure"
+#line 11310 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11412,7 +11413,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11415 "configure"
+#line 11416 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11650,6 +11651,28 @@
 
 
 
+
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
+
 
 #AC_MSG_NOTICE([====== Finished libtool configuration]) ; sleep 10
 
diff -urN gcc-4.5.3.orig/libgfortran/configure.ac gcc-4.5.3/libgfortran/configure.ac
--- gcc-4.5.3.orig/libgfortran/configure.ac	2009-09-22 03:23:06.000000000 -0700
+++ gcc-4.5.3/libgfortran/configure.ac	2012-09-13 01:47:46.288501500 -0700
@@ -181,6 +181,7 @@
 #AC_MSG_NOTICE([====== Starting libtool configuration])
 AC_LIBTOOL_DLOPEN
 AM_PROG_LIBTOOL
+ACX_LT_HOST_FLAGS
 AC_SUBST(enable_shared)
 AC_SUBST(enable_static)
 #AC_MSG_NOTICE([====== Finished libtool configuration]) ; sleep 10
diff -urN gcc-4.5.3.orig/libgomp/ChangeLog gcc-4.5.3/libgomp/ChangeLog
--- gcc-4.5.3.orig/libgomp/ChangeLog	2011-04-28 07:09:48.000000000 -0700
+++ gcc-4.5.3/libgomp/ChangeLog	2012-09-13 01:47:46.309501500 -0700
@@ -42,6 +42,17 @@
 	* parallel.c (GOMP_parallel_end): Unlock gomp_remaining_threads_lock
 	at the end if sync builtins aren't supported.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac: Invoke ACX_LT_HOST_FLAGS.
+	* Makefile.am (libgomp_la_LDFLAGS): Use lt_host_flags.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+	* Makefile.in: Regenerate.
+	* testsuite/Makefile.in: Regenerate.
+
 2010-12-03  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>
 
 	Backport from mainline:
diff -urN gcc-4.5.3.orig/libgomp/Makefile.am gcc-4.5.3/libgomp/Makefile.am
--- gcc-4.5.3.orig/libgomp/Makefile.am	2009-09-10 22:02:20.000000000 -0700
+++ gcc-4.5.3/libgomp/Makefile.am	2012-09-13 01:47:46.322501500 -0700
@@ -28,7 +28,7 @@
 endif
 libgomp_version_info = -version-info $(libtool_VERSION)
 libgomp_la_LDFLAGS = $(libgomp_version_info) $(libgomp_version_script) \
-        -no-undefined -bindir "$(bindir)"
+        $(lt_host_flags)
 libgomp_la_LINK = $(LINK) $(libgomp_la_LDFLAGS)
 
 libgomp_la_SOURCES = alloc.c barrier.c critical.c env.c error.c iter.c \
diff -urN gcc-4.5.3.orig/libgomp/Makefile.in gcc-4.5.3/libgomp/Makefile.in
--- gcc-4.5.3.orig/libgomp/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libgomp/Makefile.in	2012-09-13 01:47:46.329501500 -0700
@@ -52,6 +52,7 @@
 	$(top_srcdir)/../config/enable.m4 \
 	$(top_srcdir)/../config/futex.m4 \
 	$(top_srcdir)/../config/lead-dot.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/override.m4 \
 	$(top_srcdir)/../config/stdint.m4 \
@@ -304,6 +305,7 @@
 link_gomp = @link_gomp@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
@@ -341,7 +343,7 @@
 @LIBGOMP_BUILD_VERSIONED_SHLIB_TRUE@libgomp_version_script = -Wl,--version-script,$(top_srcdir)/libgomp.map
 libgomp_version_info = -version-info $(libtool_VERSION)
 libgomp_la_LDFLAGS = $(libgomp_version_info) $(libgomp_version_script) \
-        -no-undefined -bindir "$(bindir)"
+        $(lt_host_flags)
 
 libgomp_la_LINK = $(LINK) $(libgomp_la_LDFLAGS)
 libgomp_la_SOURCES = alloc.c barrier.c critical.c env.c error.c iter.c \
diff -urN gcc-4.5.3.orig/libgomp/aclocal.m4 gcc-4.5.3/libgomp/aclocal.m4
--- gcc-4.5.3.orig/libgomp/aclocal.m4	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libgomp/aclocal.m4	2012-09-13 01:47:46.336501500 -0700
@@ -973,6 +973,7 @@
 m4_include([../config/enable.m4])
 m4_include([../config/futex.m4])
 m4_include([../config/lead-dot.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/override.m4])
 m4_include([../config/stdint.m4])
diff -urN gcc-4.5.3.orig/libgomp/configure gcc-4.5.3/libgomp/configure
--- gcc-4.5.3.orig/libgomp/configure	2012-09-13 00:20:04.723001500 -0700
+++ gcc-4.5.3/libgomp/configure	2012-09-13 01:47:46.351501500 -0700
@@ -632,6 +632,7 @@
 MAINTAINER_MODE_TRUE
 enable_static
 enable_shared
+lt_host_flags
 CPP
 OTOOL64
 OTOOL
@@ -11082,7 +11083,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11085 "configure"
+#line 11086 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11188,7 +11189,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11191 "configure"
+#line 11192 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11426,6 +11427,28 @@
 
 
 
+
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
+
 
 
 
diff -urN gcc-4.5.3.orig/libgomp/configure.ac gcc-4.5.3/libgomp/configure.ac
--- gcc-4.5.3.orig/libgomp/configure.ac	2010-01-26 13:32:28.000000000 -0800
+++ gcc-4.5.3/libgomp/configure.ac	2012-09-13 01:47:46.377501500 -0700
@@ -134,6 +134,7 @@
 
 # Configure libtool
 AM_PROG_LIBTOOL
+ACX_LT_HOST_FLAGS
 AC_SUBST(enable_shared)
 AC_SUBST(enable_static)
 
diff -urN gcc-4.5.3.orig/libgomp/testsuite/Makefile.in gcc-4.5.3/libgomp/testsuite/Makefile.in
--- gcc-4.5.3.orig/libgomp/testsuite/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libgomp/testsuite/Makefile.in	2012-09-13 01:47:46.382501500 -0700
@@ -42,6 +42,7 @@
 	$(top_srcdir)/../config/enable.m4 \
 	$(top_srcdir)/../config/futex.m4 \
 	$(top_srcdir)/../config/lead-dot.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/override.m4 \
 	$(top_srcdir)/../config/stdint.m4 \
@@ -181,6 +182,7 @@
 link_gomp = @link_gomp@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libjava/ChangeLog gcc-4.5.3/libjava/ChangeLog
--- gcc-4.5.3.orig/libjava/ChangeLog	2011-04-28 07:10:19.000000000 -0700
+++ gcc-4.5.3/libjava/ChangeLog	2012-09-13 01:47:46.386501500 -0700
@@ -32,6 +32,19 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac: Invoke ACX_LT_HOST_FLAGS.
+	* configure.host (libgcj_sublib_ltflags): Use lt_host_flags.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+	* Makefile.in: Regenerate.
+	* gcj/Makefile.in: Regenerate.
+	* include/Makefile.in: Regenerate.
+	* testsuite/Makefile.in: Regenerate.
+
 2010-12-03  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>
 
 	Backport from mainline:
diff -urN gcc-4.5.3.orig/libjava/Makefile.in gcc-4.5.3/libjava/Makefile.in
--- gcc-4.5.3.orig/libjava/Makefile.in	2012-09-13 00:20:40.817001500 -0700
+++ gcc-4.5.3/libjava/Makefile.in	2012-09-13 01:47:46.412501500 -0700
@@ -104,6 +104,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -844,6 +845,7 @@
 libstdcxx_incdir = @libstdcxx_incdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 mkinstalldirs = @mkinstalldirs@
diff -urN gcc-4.5.3.orig/libjava/aclocal.m4 gcc-4.5.3/libjava/aclocal.m4
--- gcc-4.5.3.orig/libjava/aclocal.m4	2012-09-13 00:20:40.745001500 -0700
+++ gcc-4.5.3/libjava/aclocal.m4	2012-09-13 01:47:46.441501500 -0700
@@ -1034,6 +1034,7 @@
 m4_include([../config/lib-ld.m4])
 m4_include([../config/lib-link.m4])
 m4_include([../config/lib-prefix.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/no-executables.m4])
 m4_include([../config/override.m4])
diff -urN gcc-4.5.3.orig/libjava/configure gcc-4.5.3/libjava/configure
--- gcc-4.5.3.orig/libjava/configure	2012-09-13 00:20:40.896001500 -0700
+++ gcc-4.5.3/libjava/configure	2012-09-13 01:49:45.403501500 -0700
@@ -748,6 +748,7 @@
 GCJFLAGS
 ac_ct_GCJ
 GCJ
+lt_host_flags
 CXXCPP
 CPP
 OTOOL64
@@ -13351,7 +13352,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 13342 "configure"
+#line 13343 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -13457,7 +13458,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 13448 "configure"
+#line 13449 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -16723,6 +16724,28 @@
 
 
 
+
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
+
 if test -n "$ac_tool_prefix"; then
   for ac_prog in gcj
   do
@@ -19436,7 +19459,7 @@
   enableval=$enable_sjlj_exceptions; :
 else
   cat > conftest.$ac_ext << EOF
-#line 19427 "configure"
+#line 19450 "configure"
 struct S { ~S(); };
 void bar();
 void foo()
diff -urN gcc-4.5.3.orig/libjava/configure.ac gcc-4.5.3/libjava/configure.ac
--- gcc-4.5.3.orig/libjava/configure.ac	2012-09-13 00:20:39.355001500 -0700
+++ gcc-4.5.3/libjava/configure.ac	2012-09-13 01:47:46.542501500 -0700
@@ -551,6 +551,7 @@
 AC_SUBST(LIBLTDL)
 AC_SUBST(DIRLTDL)
 AC_PROG_LIBTOOL
+ACX_LT_HOST_FLAGS
 AM_PROG_GCJ
 AM_PROG_CC_C_O
 
diff -urN gcc-4.5.3.orig/libjava/configure.host gcc-4.5.3/libjava/configure.host
--- gcc-4.5.3.orig/libjava/configure.host	2010-07-15 05:05:56.000000000 -0700
+++ gcc-4.5.3/libjava/configure.host	2012-09-13 01:47:46.559501500 -0700
@@ -356,7 +356,7 @@
   	BACKTRACESPEC=
 	# Win32 DLLs are limited to 64k exported symbols each.
 	enable_libgcj_sublibs_default=yes
-	libgcj_sublib_ltflags='-no-undefined -bindir $(bindir) \
+	libgcj_sublib_ltflags='$(lt_host_flags) \
 	    -Wl,-u,__ZN3org4ietf4jgss10GSSManagerC1Ev,-L..,-lgcj-noncore-dummy'
 	libgcj_sublib_core_extra_deps=libgcj-noncore-dummy.dll.a
   ;;
diff -urN gcc-4.5.3.orig/libjava/gcj/Makefile.in gcc-4.5.3/libjava/gcj/Makefile.in
--- gcc-4.5.3.orig/libjava/gcj/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libjava/gcj/Makefile.in	2012-09-13 01:47:46.566501500 -0700
@@ -52,6 +52,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -308,6 +309,7 @@
 libstdcxx_incdir = @libstdcxx_incdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 mkinstalldirs = @mkinstalldirs@
diff -urN gcc-4.5.3.orig/libjava/include/Makefile.in gcc-4.5.3/libjava/include/Makefile.in
--- gcc-4.5.3.orig/libjava/include/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libjava/include/Makefile.in	2012-09-13 01:47:46.581501500 -0700
@@ -51,6 +51,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -308,6 +309,7 @@
 libstdcxx_incdir = @libstdcxx_incdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 mkinstalldirs = @mkinstalldirs@
diff -urN gcc-4.5.3.orig/libjava/testsuite/Makefile.in gcc-4.5.3/libjava/testsuite/Makefile.in
--- gcc-4.5.3.orig/libjava/testsuite/Makefile.in	2010-10-06 11:54:14.000000000 -0700
+++ gcc-4.5.3/libjava/testsuite/Makefile.in	2012-09-13 01:47:46.592501500 -0700
@@ -49,6 +49,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -283,6 +284,7 @@
 libstdcxx_incdir = @libstdcxx_incdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 mkinstalldirs = @mkinstalldirs@
diff -urN gcc-4.5.3.orig/libobjc/ChangeLog gcc-4.5.3/libobjc/ChangeLog
--- gcc-4.5.3.orig/libobjc/ChangeLog	2011-04-28 07:09:30.000000000 -0700
+++ gcc-4.5.3/libobjc/ChangeLog	2012-09-13 01:47:46.613501500 -0700
@@ -6,6 +6,15 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac (extra_ldflags_libobjc): Invoke ACX_LT_HOST_FLAGS.
+	* Makefile.in (lt_host_flags): Import AC_SUBST'd value.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+
 2010-07-31  Release Manager
 
 	* GCC 4.5.1 released.
diff -urN gcc-4.5.3.orig/libobjc/Makefile.in gcc-4.5.3/libobjc/Makefile.in
--- gcc-4.5.3.orig/libobjc/Makefile.in	2010-03-22 22:05:35.000000000 -0700
+++ gcc-4.5.3/libobjc/Makefile.in	2012-09-13 01:47:46.620501500 -0700
@@ -43,6 +43,7 @@
 includedirname = @includedirname@
 libsuffix = @libsuffix@
 
+lt_host_flags = @lt_host_flags@
 extra_ldflags_libobjc = @extra_ldflags_libobjc@
 
 top_builddir = .
diff -urN gcc-4.5.3.orig/libobjc/aclocal.m4 gcc-4.5.3/libobjc/aclocal.m4
--- gcc-4.5.3.orig/libobjc/aclocal.m4	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libobjc/aclocal.m4	2012-09-13 01:47:46.623501500 -0700
@@ -198,6 +198,7 @@
 m4_include([../ltsugar.m4])
 m4_include([../ltversion.m4])
 m4_include([../lt~obsolete.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/override.m4])
 m4_include([acinclude.m4])
diff -urN gcc-4.5.3.orig/libobjc/configure gcc-4.5.3/libobjc/configure
--- gcc-4.5.3.orig/libobjc/configure	2010-03-22 22:05:35.000000000 -0700
+++ gcc-4.5.3/libobjc/configure	2012-09-13 01:47:46.662501500 -0700
@@ -631,6 +631,7 @@
 AR
 AS
 extra_ldflags_libobjc
+lt_host_flags
 OBJEXT
 EXEEXT
 ac_ct_CC
@@ -3316,14 +3317,36 @@
 
 
 # extra LD Flags which are required for targets
+
+
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
 case "${host}" in
   *-darwin*)
     # Darwin needs -single_module when linking libobjc
-    extra_ldflags_libobjc=-Wl,-single_module
+    extra_ldflags_libobjc='$(lt_host_flags) -Wl,-single_module'
     ;;
   *-cygwin*|*-mingw*)
     # Tell libtool to build DLLs on Windows
-    extra_ldflags_libobjc='-no-undefined -bindir $(bindir)'
+    extra_ldflags_libobjc='$(lt_host_flags)'
     ;;
 esac
 
@@ -10566,7 +10589,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10569 "configure"
+#line 10592 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10672,7 +10695,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10675 "configure"
+#line 10698 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11246,7 +11269,7 @@
   enableval=$enable_sjlj_exceptions; :
 else
   cat > conftest.$ac_ext << EOF
-#line 11249 "configure"
+#line 11272 "configure"
 @interface Frob
 @end
 @implementation Frob
diff -urN gcc-4.5.3.orig/libobjc/configure.ac gcc-4.5.3/libobjc/configure.ac
--- gcc-4.5.3.orig/libobjc/configure.ac	2010-03-22 22:05:35.000000000 -0700
+++ gcc-4.5.3/libobjc/configure.ac	2012-09-13 01:47:46.699501500 -0700
@@ -156,14 +156,15 @@
 m4_rename_force([real_PRECIOUS],[_AC_ARG_VAR_PRECIOUS])
 
 # extra LD Flags which are required for targets
+ACX_LT_HOST_FLAGS
 case "${host}" in
   *-darwin*)
     # Darwin needs -single_module when linking libobjc
-    extra_ldflags_libobjc=-Wl,-single_module
+    extra_ldflags_libobjc='$(lt_host_flags) -Wl,-single_module'
     ;;
   *-cygwin*|*-mingw*)
     # Tell libtool to build DLLs on Windows
-    extra_ldflags_libobjc='-no-undefined -bindir $(bindir)'
+    extra_ldflags_libobjc='$(lt_host_flags)'
     ;;
 esac
 AC_SUBST(extra_ldflags_libobjc)
diff -urN gcc-4.5.3.orig/libssp/ChangeLog gcc-4.5.3/libssp/ChangeLog
--- gcc-4.5.3.orig/libssp/ChangeLog	2011-04-28 07:11:09.000000000 -0700
+++ gcc-4.5.3/libssp/ChangeLog	2012-09-13 01:47:46.702501500 -0700
@@ -6,6 +6,16 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac: Invoke ACX_LT_HOST_FLAGS.
+	* Makefile.am (libssp_la_LDFLAGS): Use lt_host_flags.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+	* Makefile.in: Regenerate.
+
 2010-07-31  Release Manager
 
 	* GCC 4.5.1 released.
diff -urN gcc-4.5.3.orig/libssp/Makefile.am gcc-4.5.3/libssp/Makefile.am
--- gcc-4.5.3.orig/libssp/Makefile.am	2009-08-22 06:41:50.000000000 -0700
+++ gcc-4.5.3/libssp/Makefile.am	2012-09-13 01:47:46.705501500 -0700
@@ -35,7 +35,7 @@
 libssp_la_LIBADD = 
 libssp_la_DEPENDENCIES = $(version_dep) $(libssp_la_LIBADD)
 libssp_la_LDFLAGS = -version-info `grep -v '^\#' $(srcdir)/libtool-version` \
-		    $(version_arg) -no-undefined -bindir "$(bindir)"
+		    $(version_arg) $(lt_host_flags)
 
 libssp_nonshared_la_SOURCES = \
 	ssp-local.c
diff -urN gcc-4.5.3.orig/libssp/Makefile.in gcc-4.5.3/libssp/Makefile.in
--- gcc-4.5.3.orig/libssp/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libssp/Makefile.in	2012-09-13 01:47:46.710501500 -0700
@@ -48,6 +48,7 @@
 am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \
 	$(top_srcdir)/../config/depstand.m4 \
 	$(top_srcdir)/../config/lead-dot.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -233,6 +234,7 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
@@ -280,7 +282,7 @@
 libssp_la_LIBADD = 
 libssp_la_DEPENDENCIES = $(version_dep) $(libssp_la_LIBADD)
 libssp_la_LDFLAGS = -version-info `grep -v '^\#' $(srcdir)/libtool-version` \
-		    $(version_arg) -no-undefined -bindir "$(bindir)"
+		    $(version_arg) $(lt_host_flags)
 
 libssp_nonshared_la_SOURCES = \
 	ssp-local.c
diff -urN gcc-4.5.3.orig/libssp/aclocal.m4 gcc-4.5.3/libssp/aclocal.m4
--- gcc-4.5.3.orig/libssp/aclocal.m4	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libssp/aclocal.m4	2012-09-13 01:47:46.716501500 -0700
@@ -971,6 +971,7 @@
 m4_include([../config/acx.m4])
 m4_include([../config/depstand.m4])
 m4_include([../config/lead-dot.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/no-executables.m4])
 m4_include([../config/override.m4])
diff -urN gcc-4.5.3.orig/libssp/configure gcc-4.5.3/libssp/configure
--- gcc-4.5.3.orig/libssp/configure	2009-12-05 09:18:53.000000000 -0800
+++ gcc-4.5.3/libssp/configure	2012-09-13 01:47:46.744501500 -0700
@@ -606,6 +606,7 @@
 toolexecdir
 enable_static
 enable_shared
+lt_host_flags
 OTOOL64
 OTOOL
 LIPO
@@ -10591,7 +10592,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10594 "configure"
+#line 10595 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10697,7 +10698,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10700 "configure"
+#line 10701 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10935,6 +10936,28 @@
 
 
 
+
+
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
+
 
 
 # Calculate toolexeclibdir
diff -urN gcc-4.5.3.orig/libssp/configure.ac gcc-4.5.3/libssp/configure.ac
--- gcc-4.5.3.orig/libssp/configure.ac	2009-08-24 12:08:51.000000000 -0700
+++ gcc-4.5.3/libssp/configure.ac	2012-09-13 01:47:46.760501500 -0700
@@ -131,6 +131,7 @@
 AC_SUBST(ssp_have_usable_vsnprintf)
 
 AM_PROG_LIBTOOL
+ACX_LT_HOST_FLAGS
 AC_SUBST(enable_shared)
 AC_SUBST(enable_static)
 
diff -urN gcc-4.5.3.orig/libstdc++-v3/ChangeLog gcc-4.5.3/libstdc++-v3/ChangeLog
--- gcc-4.5.3.orig/libstdc++-v3/ChangeLog	2011-04-28 07:09:18.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/ChangeLog	2012-09-13 01:47:46.795501500 -0700
@@ -99,6 +99,23 @@
 
 	* GCC 4.5.2 released.
 
+2010-12-06  Dave Korn  <dave.korn.cygwin@gmail.com>
+
+	PR target/40125
+	PR lto/46695
+	* configure.ac: Invoke ACX_LT_HOST_FLAGS.
+	* configure.host (OPT_LDFLAGS): Use lt_host_flags for cygming.
+	* aclocal.m4: Regenerate.
+	* configure: Regenerate.
+	* Makefile.in: Regenerate.
+	* doc/Makefile.in: Regenerate.
+	* include/Makefile.in: Regenerate.
+	* libsupc++/Makefile.in: Regenerate.
+	* po/Makefile.in: Regenerate.
+	* python/Makefile.in: Regenerate.
+	* src/Makefile.in: Regenerate.
+	* testsuite/Makefile.in: Regenerate.
+
 2010-12-03  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>
 
 	Backport from mainline:
diff -urN gcc-4.5.3.orig/libstdc++-v3/Makefile.in gcc-4.5.3/libstdc++-v3/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/Makefile.in	2012-09-13 01:47:46.822501500 -0700
@@ -50,6 +50,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -282,6 +283,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/aclocal.m4 gcc-4.5.3/libstdc++-v3/aclocal.m4
--- gcc-4.5.3.orig/libstdc++-v3/aclocal.m4	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/aclocal.m4	2012-09-13 01:47:46.829501500 -0700
@@ -661,6 +661,7 @@
 m4_include([../config/lib-ld.m4])
 m4_include([../config/lib-link.m4])
 m4_include([../config/lib-prefix.m4])
+m4_include([../config/lthostflags.m4])
 m4_include([../config/multi.m4])
 m4_include([../config/no-executables.m4])
 m4_include([../config/override.m4])
diff -urN gcc-4.5.3.orig/libstdc++-v3/configure gcc-4.5.3/libstdc++-v3/configure
--- gcc-4.5.3.orig/libstdc++-v3/configure	2010-08-27 11:25:00.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/configure	2012-09-13 01:47:46.870501500 -0700
@@ -687,6 +687,7 @@
 GLIBCXX_HOSTED_TRUE
 enable_static
 enable_shared
+lt_host_flags
 CXXCPP
 OTOOL64
 OTOOL
@@ -11441,7 +11442,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11444 "configure"
+#line 11445 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11547,7 +11548,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 11550 "configure"
+#line 11551 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -14815,6 +14816,28 @@
 
 
 
+case $host in
+  *-cygwin* | *-mingw*)
+    # 'host' will be top-level target in the case of a target lib,
+    # we must compare to with_cross_host to decide if this is a native
+    # or cross-compiler and select where to install dlls appropriately.
+    if test -n "$with_cross_host" &&
+	test x"$with_cross_host" != x"no"; then
+      lt_host_flags='-no-undefined -bindir "$(toolexeclibdir)"';
+    else
+      lt_host_flags='-no-undefined -bindir "$(bindir)"';
+    fi
+    ;;
+  *)
+    lt_host_flags=
+    ;;
+esac
+
+
+
+
+
+
 # Eliminate -lstdc++ addition to postdeps for cross compiles.
 postdeps_CXX=`echo " $postdeps_CXX " | sed 's, -lstdc++ ,,g'`
 
@@ -14887,7 +14910,7 @@
     #
     # Fake what AC_TRY_COMPILE does.  XXX Look at redoing this new-style.
     cat > conftest.$ac_ext << EOF
-#line 14890 "configure"
+#line 14913 "configure"
 struct S { ~S(); };
 void bar();
 void foo()
@@ -15255,7 +15278,7 @@
   # Fake what AC_TRY_COMPILE does.
 
     cat > conftest.$ac_ext << EOF
-#line 15258 "configure"
+#line 15281 "configure"
 int main()
 {
   typedef bool atomic_type;
@@ -15292,7 +15315,7 @@
     rm -f conftest*
 
     cat > conftest.$ac_ext << EOF
-#line 15295 "configure"
+#line 15318 "configure"
 int main()
 {
   typedef short atomic_type;
@@ -15329,7 +15352,7 @@
     rm -f conftest*
 
     cat > conftest.$ac_ext << EOF
-#line 15332 "configure"
+#line 15355 "configure"
 int main()
 {
   // NB: _Atomic_word not necessarily int.
@@ -15367,7 +15390,7 @@
     rm -f conftest*
 
     cat > conftest.$ac_ext << EOF
-#line 15370 "configure"
+#line 15393 "configure"
 int main()
 {
   typedef long long atomic_type;
@@ -15443,7 +15466,7 @@
   # unnecessary for this test.
 
     cat > conftest.$ac_ext << EOF
-#line 15446 "configure"
+#line 15469 "configure"
 int main()
 {
   _Decimal32 d1;
diff -urN gcc-4.5.3.orig/libstdc++-v3/configure.ac gcc-4.5.3/libstdc++-v3/configure.ac
--- gcc-4.5.3.orig/libstdc++-v3/configure.ac	2010-01-16 06:46:57.000000000 -0800
+++ gcc-4.5.3/libstdc++-v3/configure.ac	2012-09-13 01:47:46.950501500 -0700
@@ -95,6 +95,7 @@
   AC_LIBTOOL_DLOPEN
 fi
 AM_PROG_LIBTOOL
+ACX_LT_HOST_FLAGS
 AC_SUBST(enable_shared)
 AC_SUBST(enable_static)
 
diff -urN gcc-4.5.3.orig/libstdc++-v3/configure.host gcc-4.5.3/libstdc++-v3/configure.host
--- gcc-4.5.3.orig/libstdc++-v3/configure.host	2012-09-13 00:20:38.394001500 -0700
+++ gcc-4.5.3/libstdc++-v3/configure.host	2012-09-13 01:47:46.955501500 -0700
@@ -210,7 +210,7 @@
   cygwin*)
     os_include_dir="os/newlib"
     OPT_LDFLAGS="-Wl,--exclude-modules-for-implib=\`cd ../libsupc++; ls *type_inf*.o -1  | tr '\012' ':'\`tinfo.o:tinfo2.o"
-    OPT_LDFLAGS="${OPT_LDFLAGS} -no-undefined -bindir \$(bindir)"
+    OPT_LDFLAGS="${OPT_LDFLAGS} \$(lt_host_flags)"
     ;;
   darwin | darwin[1-7] | darwin[1-7].*)
     # On Darwin, performance is improved if libstdc++ is single-module.
@@ -260,7 +260,7 @@
   mingw32*)
     os_include_dir="os/mingw32"
     error_constants_dir="os/mingw32"
-    OPT_LDFLAGS="${OPT_LDFLAGS} -no-undefined -bindir \$(bindir)"
+    OPT_LDFLAGS="${OPT_LDFLAGS} \$(lt_host_flags)"
     ;;
   netbsd*)
     os_include_dir="os/bsd/netbsd"
diff -urN gcc-4.5.3.orig/libstdc++-v3/doc/Makefile.in gcc-4.5.3/libstdc++-v3/doc/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/doc/Makefile.in	2011-02-08 12:39:29.000000000 -0800
+++ gcc-4.5.3/libstdc++-v3/doc/Makefile.in	2012-09-13 01:47:46.975501500 -0700
@@ -45,6 +45,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -219,6 +220,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/include/Makefile.in gcc-4.5.3/libstdc++-v3/include/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/include/Makefile.in	2012-09-13 00:20:10.506001500 -0700
+++ gcc-4.5.3/libstdc++-v3/include/Makefile.in	2012-09-13 01:47:46.982501500 -0700
@@ -47,6 +47,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -221,6 +222,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/libsupc++/Makefile.in gcc-4.5.3/libstdc++-v3/libsupc++/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/libsupc++/Makefile.in	2012-09-13 00:20:38.452001500 -0700
+++ gcc-4.5.3/libstdc++-v3/libsupc++/Makefile.in	2012-09-13 01:47:46.999501500 -0700
@@ -47,6 +47,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -303,6 +304,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/po/Makefile.in gcc-4.5.3/libstdc++-v3/po/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/po/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/po/Makefile.in	2012-09-13 01:47:47.006501500 -0700
@@ -45,6 +45,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -219,6 +220,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/python/Makefile.in gcc-4.5.3/libstdc++-v3/python/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/python/Makefile.in	2012-09-13 00:20:20.588001500 -0700
+++ gcc-4.5.3/libstdc++-v3/python/Makefile.in	2012-09-13 01:47:47.018501500 -0700
@@ -46,6 +46,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -243,6 +244,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/src/Makefile.in gcc-4.5.3/libstdc++-v3/src/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/src/Makefile.in	2012-09-13 00:20:38.463001500 -0700
+++ gcc-4.5.3/libstdc++-v3/src/Makefile.in	2012-09-13 01:47:47.024501500 -0700
@@ -46,6 +46,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -298,6 +299,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
diff -urN gcc-4.5.3.orig/libstdc++-v3/testsuite/Makefile.in gcc-4.5.3/libstdc++-v3/testsuite/Makefile.in
--- gcc-4.5.3.orig/libstdc++-v3/testsuite/Makefile.in	2010-04-02 11:18:06.000000000 -0700
+++ gcc-4.5.3/libstdc++-v3/testsuite/Makefile.in	2012-09-13 01:47:47.031501500 -0700
@@ -45,6 +45,7 @@
 	$(top_srcdir)/../config/lib-ld.m4 \
 	$(top_srcdir)/../config/lib-link.m4 \
 	$(top_srcdir)/../config/lib-prefix.m4 \
+	$(top_srcdir)/../config/lthostflags.m4 \
 	$(top_srcdir)/../config/multi.m4 \
 	$(top_srcdir)/../config/no-executables.m4 \
 	$(top_srcdir)/../config/override.m4 \
@@ -219,6 +220,7 @@
 libtool_VERSION = @libtool_VERSION@
 localedir = @localedir@
 localstatedir = @localstatedir@
+lt_host_flags = @lt_host_flags@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 multi_basedir = @multi_basedir@
